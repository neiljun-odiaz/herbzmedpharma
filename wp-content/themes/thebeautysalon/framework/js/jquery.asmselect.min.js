/*
 * Alternate Select Multiple (asmSelect) 1.0.4a beta - jQuery Plugin
 * http://www.ryancramer.com/projects/asmselect/
 * 
 * Copyright (c) 2009 by Ryan Cramer - http://www.ryancramer.com
 * 
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 */
(function(a){a.fn.asmSelect=function(b){var c={listType:"ol",sortable:false,highlight:false,animate:false,addItemTarget:"bottom",hideWhenAdded:false,debugMode:false,removeLabel:"remove",highlightAddedLabel:"Added: ",highlightRemovedLabel:"Removed: ",containerClass:"asmContainer",selectClass:"asmSelect",optionDisabledClass:"asmOptionDisabled",listClass:"asmList",listSortableClass:"asmListSortable",listItemClass:"asmListItem",listItemLabelClass:"asmListItemLabel",removeClass:"asmListItemRemove",highlightClass:"asmHighlight"};a.extend(c,b);return this.each(function(b){function z(b,c){j=true;$option=a("#"+b);d.trigger("change",[{option:$option,value:$option.val(),id:b,item:g.children("[rel="+b+"]"),type:c}])}function y(d,e){if(!c.highlight)return;f.next("#"+c.highlightClass+b).remove();var g=a("<span></span>").hide().addClass(c.highlightClass).attr("id",c.highlightClass+b).html(e+d.children("."+c.listItemLabelClass).slice(0,1).text());f.after(g);g.fadeIn("fast",function(){setTimeout(function(){g.fadeOut("slow")},50)})}function x(a){if(c.animate&&!h){$prevItem=a.prev("li");a.animate({opacity:"hide",height:"hide"},100,"linear",function(){$prevItem.animate({height:"-=2px"},50,"swing",function(){$prevItem.animate({height:"+=2px"},100,"swing")});a.remove()})}else{a.remove()}}function w(b,d){if(d==undefined)var d=true;var e=a("#"+b);e.attr("selected",false);$item=g.children("li[rel="+b+"]");x($item);t(a("[rel="+b+"]",c.removeWhenAdded?$selectRemoved:f));if(d)y($item,c.highlightRemovedLabel);z(b,"drop")}function v(a){if(c.animate&&!h){a.animate({opacity:"show",height:"show"},100,"swing",function(){a.animate({height:"+=2px"},50,"swing",function(){a.animate({height:"-=2px"},25,"swing")})})}else{a.show()}}function u(b){var e=a("#"+b);if(!e)return;var i=a("<a></a>").attr("href","#").addClass(c.removeClass).prepend(c.removeLabel).click(function(){w(a(this).parent("li").attr("rel"));return false});var j=a("<span></span>").addClass(c.listItemLabelClass).html(e.html());var k=a("<li></li>").attr("rel",b).addClass(c.listItemClass).append(j).append(i).hide();if(!h){if(e.is(":selected"))return;e.attr("selected",true)}if(c.addItemTarget=="top"&&!h){g.prepend(k);if(c.sortable)d.prepend(e)}else{g.append(k);if(c.sortable)d.append(e)}v(k);s(a("[rel="+b+"]",f));if(!h){y(k,c.highlightAddedLabel);r();if(c.sortable)g.sortable("refresh")}}function t(b){b.removeClass(c.optionDisabledClass).attr("disabled",false);if(c.hideWhenAdded)b.show();if(a.browser.msie)f.hide().show()}function s(b){b.addClass(c.optionDisabledClass).attr("selected",false).attr("disabled",true);if(c.hideWhenAdded)b.hide();if(a.browser.msie)f.hide().show()}function r(){f.children(":eq(0)").attr("selected",true)}function q(b,c){if(c==undefined)var c=false;var d=a("#"+b);var e=a("<option>"+d.text()+"</option>").val(d.val()).attr("rel",b);if(c)s(e);f.append(e)}function p(){h=true;f.prepend("<option>"+d.attr("title")+"</option>");d.children("option").each(function(c){var d=a(this);var e;if(!d.attr("id"))d.attr("id","asm"+b+"option"+c);e=d.attr("id");if(d.is(":selected")){u(e);q(e,true)}else{q(e)}});if(!c.debugMode)d.hide();r();h=false}function o(b){if(j){j=false;return}f.empty();g.empty();p();if(a.browser.opera)g.hide().fadeIn("fast")}function n(){i=true}function m(b){if(a.browser.msie&&a.browser.version<7&&!i)return;var c=a(this).children("option:selected").slice(0,1).attr("rel");u(c);i=false;z(c,"add")}function l(){g.sortable({items:"li."+c.listItemClass,handle:"."+c.listItemLabelClass,axis:"y",update:function(b,c){var e;a(this).children("li").each(function(b){$option=a("#"+a(this).attr("rel"));if(a(this).is(".ui-sortable-helper")){e=$option.attr("id");return}d.append($option)});if(e)z(e,"sort")}}).addClass(c.listSortableClass)}function k(){while(a("#"+c.containerClass+b).size()>0)b++;f=a("<select></select>").addClass(c.selectClass).attr("name",c.selectClass+b).attr("id",c.selectClass+b);$selectRemoved=a("<select></select>");g=a("<"+c.listType+"></"+c.listType+">").addClass(c.listClass).attr("id",c.listClass+b);e=a("<div></div>").addClass(c.containerClass).attr("id",c.containerClass+b);p();f.change(m).click(n);d.change(o).wrap(e).before(f).before(g);if(c.sortable)l();if(a.browser.msie&&a.browser.version<8)g.css("display","inline-block")}var d=a(this);var e;var f;var g;var h=false;var i=false;var j=false;k()})}})(jQuery)